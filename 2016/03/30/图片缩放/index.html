<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>图片缩放demo | LikeStar</title>
  <meta name="author" content="ShenJinXiang">
  
  <meta name="description" content="Html canvas练习，鼠标滚轮控制图片缩放比例，鼠标拖动图片。


(function(){
    var config = {
        &#39;imgSrc&#39; : &quot;/bolg/images/001.jpg&quot;,        // 图片地址
        &#39;canvasWidth&#39; :">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="图片缩放demo"/>
  <meta property="og:site_name" content="LikeStar"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/bolg/favicon.png" rel="icon">
  <link rel="alternate" href="/bolg/atom.xml" title="LikeStar" type="application/atom+xml">
  <link rel="stylesheet" href="/bolg/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/bolg/">LikeStar</a></h1>
  <h2><a href="/bolg/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/bolg/">Home</a></li>
    
      <li><a href="/bolg/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-03-30T01:32:45.416Z"><a href="/bolg/2016/03/30/图片缩放/">2016-03-30</a></time>
      
      
  
    <h1 class="title">图片缩放demo</h1>
  

    </header>
    <div class="entry">
      
        <p>Html canvas练习，鼠标滚轮控制图片缩放比例，鼠标拖动图片。</p>
<p><canvas id="canvas" style="display:block;margin:10px auto;border:1px solid #ccc;padding:0;"></canvas></p>
<script>
(function(){
    var config = {
        'imgSrc' : "/bolg/images/001.jpg",        // 图片地址
        'canvasWidth' : 600,                    // 边框 宽
        'canvasHeight' : 450,                    // 边框 高
        'maxScale' : 4.0,                        // 最大比例
        'minScale' : 0.1,                        // 最小比例
        'scaleStep' : 0.05
    };

    var canvas = document.getElementById("canvas");
    canvas.width = config.canvasWidth;
    canvas.height = config.canvasHeight;
    var _ctx = canvas.getContext("2d");

    /**
     * 判断是否移动
     */ 
    var _isMove = false;

    /**
     * 缩放比例
     */
    var scale = 1.0;

    var lastStatus = {};

    var _img = new Image();
    _img.src = config.imgSrc;

    /**
     * 图片加载完成后 画图
     */
    _img.onload = function() {
        lastStatus.imgWidth = _img.width;
        lastStatus.imgHeight = _img.height;
        lastStatus.x = canvas.width / 2 - _img.width / 2;
        lastStatus.y = canvas.height / 2 - _img.height / 2;
        drawImgByScale(canvas.width / 2, canvas.height / 2);
    }

    canvas.onmouseout = function () {
        document.body.style.overflow = 'auto';
        _isMove = false;
        canvas.style.cursor = 'default';
    };

    canvas.onmouseup = function () {
        _isMove = false;
        canvas.style.cursor = 'default';
    };

    /**
     * 鼠标按下以后 修改状态，并记录当前鼠标坐标
     */
    canvas.onmousedown = function(e) {
        _isMove = true;
        canvas.style.cursor = 'move';
        var mXY = windowToCanvas(e.clientX, e.clientY);
        lastStatus.mx = mXY.x;
        lastStatus.my = mXY.y;
    }

    /**
     * 鼠标移动时 重新画图
     */
    canvas.onmousemove = function(e) {
        document.body.style.overflow = 'hidden';
        if(_isMove) {
            var currentXY = windowToCanvas(e.clientX, e.clientY);
            drawImgByMove(currentXY.x, currentXY.y);
        }
    };

    /**
     * 鼠标滚轮事件
     */
    canvas.onmousewheel = function (e) {
        if(e.wheelDelta > 0) {
            scale = (scale >= config.maxScale) ? config.maxScale : scale + config.scaleStep;

        } else {
            scale = (scale <= config.minScale) ? config.minScale : scale - config.scaleStep;
        }
        var mXY = windowToCanvas(e.clientX, e.clientY);
        drawImgByScale(mXY.x, mXY.y);
    };

    /**
     * 火狐浏览器 鼠标滚轮事件\
     */
    canvas.addEventListener("DOMMouseScroll", function(e) {
        if(e.detail > 0) {
            scale = (scale >= config.maxScale) ? config.maxScale : scale + config.scaleStep;
        } else {
            scale = (scale <= config.minScale) ? config.minScale : scale - config.scaleStep;
        }
        var mXY = windowToCanvas(e.clientX, e.clientY);
        drawImgByScale(mXY.x, mXY.y);
    });

    /**
     * 按坐标和比例画图
     */
    function drawImgByScale(x, y) {
        if(x >= lastStatus.x && x <= (lastStatus.x + lastStatus.imgWidth)    && y >= lastStatus.y && y <= (lastStatus.y + lastStatus.imgHeight)) {
            var imgWidth = _img.width * scale;
            var imgHeight = _img.height * scale;
            var _x = x - (x - lastStatus.x) * imgWidth / lastStatus.imgWidth;
            var _y = y - (y - lastStatus.y) * imgHeight / lastStatus.imgHeight;

            _ctx.clearRect(0, 0, canvas.width, canvas.height);
            _ctx.drawImage(_img, _x, _y, imgWidth, imgHeight);
            lastStatus = {
                imgWidth : imgWidth,
                imgHeight : imgHeight,
                x : _x,
                y : _y,
                mx : x,
                my : y
            };
        }
    }

    /**
     * 移动图片
     */
    function drawImgByMove(x, y) {
        _ctx.clearRect(0, 0, canvas.width, canvas.height);
        var _x = lastStatus.x + (x - lastStatus.mx);
        var _y = lastStatus.y + (y - lastStatus.my);
        _ctx.drawImage(_img, _x, _y, lastStatus.imgWidth, lastStatus.imgHeight);

        lastStatus.mx = x;
        lastStatus.my = y;
        lastStatus.x = _x;
        lastStatus.y = _y;
    }

    /**
     * 窗口的左边换算成canvas坐标
     */
    function windowToCanvas(x, y) {
        var _box = canvas.getBoundingClientRect();
        return {
            'x' : x - _box['left'],
            'y' : y - _box['top']
        };
    }
})();
</script>

      
    </div>
    <footer>
      
        
        
        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://yoursite.com/2016/03/30/图片缩放/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 ShenJinXiang
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/bolg/js/jquery.imagesloaded.min.js"></script>
<script src="/bolg/js/gallery.js"></script>




<link rel="stylesheet" href="/bolg/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/bolg/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
