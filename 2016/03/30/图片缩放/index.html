<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>图片缩放demo | LikeStar</title>
  <meta name="author" content="ShenJinXiang">
  
  <meta name="description" content="Html canvas练习，鼠标滚轮控制图片缩放比例，鼠标拖动图片。


(function(){
    var config = {
        &#39;imgSrc&#39; : &quot;/bolg/images/001.jpg&quot;,        // 图片地址
        &#39;canvasWidth&#39; :">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="图片缩放demo"/>
  <meta property="og:site_name" content="LikeStar"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <link rel="alternative" href="/blog/atom.xml" title="LikeStar" type="application/atom+xml">
  
  
    <link href="/blog/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/blog/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/blog/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/blog/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/blog/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/blog/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/blog/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/blog/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/blog/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

</head>

<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/blog/">LikeStar</a><span class="split"></span><span class="title">图片缩放demo</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2016-03-30</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  

  
	<div class="col-md-12">
	  

	  <!-- content -->
	  <p>Html canvas练习，鼠标滚轮控制图片缩放比例，鼠标拖动图片。</p>
<p><canvas id="canvas" style="display:block;margin:10px auto;border:1px solid #ccc;padding:0;"></canvas></p>
<script>
(function(){
    var config = {
        'imgSrc' : "/bolg/images/001.jpg",        // 图片地址
        'canvasWidth' : 600,                    // 边框 宽
        'canvasHeight' : 450,                    // 边框 高
        'maxScale' : 4.0,                        // 最大比例
        'minScale' : 0.1,                        // 最小比例
        'scaleStep' : 0.05
    };

    var canvas = document.getElementById("canvas");
    canvas.width = config.canvasWidth;
    canvas.height = config.canvasHeight;
    var _ctx = canvas.getContext("2d");

    /**
     * 判断是否移动
     */ 
    var _isMove = false;

    /**
     * 缩放比例
     */
    var scale = 1.0;

    var lastStatus = {};

    var _img = new Image();
    _img.src = config.imgSrc;

    /**
     * 图片加载完成后 画图
     */
    _img.onload = function() {
        lastStatus.imgWidth = _img.width;
        lastStatus.imgHeight = _img.height;
        lastStatus.x = canvas.width / 2 - _img.width / 2;
        lastStatus.y = canvas.height / 2 - _img.height / 2;
        drawImgByScale(canvas.width / 2, canvas.height / 2);
    }

    canvas.onmouseout = function () {
        document.body.style.overflow = 'auto';
        _isMove = false;
        canvas.style.cursor = 'default';
    };

    canvas.onmouseup = function () {
        _isMove = false;
        canvas.style.cursor = 'default';
    };

    /**
     * 鼠标按下以后 修改状态，并记录当前鼠标坐标
     */
    canvas.onmousedown = function(e) {
        _isMove = true;
        canvas.style.cursor = 'move';
        var mXY = windowToCanvas(e.clientX, e.clientY);
        lastStatus.mx = mXY.x;
        lastStatus.my = mXY.y;
    }

    /**
     * 鼠标移动时 重新画图
     */
    canvas.onmousemove = function(e) {
        document.body.style.overflow = 'hidden';
        if(_isMove) {
            var currentXY = windowToCanvas(e.clientX, e.clientY);
            drawImgByMove(currentXY.x, currentXY.y);
        }
    };

    /**
     * 鼠标滚轮事件
     */
    canvas.onmousewheel = function (e) {
        if(e.wheelDelta > 0) {
            scale = (scale >= config.maxScale) ? config.maxScale : scale + config.scaleStep;

        } else {
            scale = (scale <= config.minScale) ? config.minScale : scale - config.scaleStep;
        }
        var mXY = windowToCanvas(e.clientX, e.clientY);
        drawImgByScale(mXY.x, mXY.y);
    };

    /**
     * 火狐浏览器 鼠标滚轮事件\
     */
    canvas.addEventListener("DOMMouseScroll", function(e) {
        if(e.detail > 0) {
            scale = (scale >= config.maxScale) ? config.maxScale : scale + config.scaleStep;
        } else {
            scale = (scale <= config.minScale) ? config.minScale : scale - config.scaleStep;
        }
        var mXY = windowToCanvas(e.clientX, e.clientY);
        drawImgByScale(mXY.x, mXY.y);
    });

    /**
     * 按坐标和比例画图
     */
    function drawImgByScale(x, y) {
        if(x >= lastStatus.x && x <= (lastStatus.x + lastStatus.imgWidth)    && y >= lastStatus.y && y <= (lastStatus.y + lastStatus.imgHeight)) {
            var imgWidth = _img.width * scale;
            var imgHeight = _img.height * scale;
            var _x = x - (x - lastStatus.x) * imgWidth / lastStatus.imgWidth;
            var _y = y - (y - lastStatus.y) * imgHeight / lastStatus.imgHeight;

            _ctx.clearRect(0, 0, canvas.width, canvas.height);
            _ctx.drawImage(_img, _x, _y, imgWidth, imgHeight);
            lastStatus = {
                imgWidth : imgWidth,
                imgHeight : imgHeight,
                x : _x,
                y : _y,
                mx : x,
                my : y
            };
        }
    }

    /**
     * 移动图片
     */
    function drawImgByMove(x, y) {
        _ctx.clearRect(0, 0, canvas.width, canvas.height);
        var _x = lastStatus.x + (x - lastStatus.mx);
        var _y = lastStatus.y + (y - lastStatus.my);
        _ctx.drawImage(_img, _x, _y, lastStatus.imgWidth, lastStatus.imgHeight);

        lastStatus.mx = x;
        lastStatus.my = y;
        lastStatus.x = _x;
        lastStatus.y = _y;
    }

    /**
     * 窗口的左边换算成canvas坐标
     */
    function windowToCanvas(x, y) {
        var _box = canvas.getBoundingClientRect();
        return {
            'x' : x - _box['left'],
            'y' : y - _box['top']
        };
    }
})();
</script>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
			
			
		
	
		
	
	
	
		<li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/blog/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next disabled"><a>next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  &copy; 2016 ShenJinXiang
  
      with help from <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-wixo/">Wixo</a>.    
</p> </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/blog/js/jquery.imagesloaded.min.js"></script>
<script src="/blog/js/gallery.js"></script>
<script src="/blog/js/bootstrap.min.js"></script>
<script src="/blog/js/jquery.tableofcontents.min.js"></script>
<script src="/blog/js/tocgenerator.min.js"></script>
<script src="/blog/js/main.js"></script>




<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
